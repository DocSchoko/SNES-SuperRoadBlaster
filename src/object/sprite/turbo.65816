/**
* turbo icon sprite
* 
* @param a<int, 16bit>  x-pos
* @param 1<int, 16bit>  y-pos
*/
.include "src/object/sprite/turbo.h"
.section "turbo_icon"

  METHOD init
  sep #$20
;  inc.b animation.isColorMath

  rep #$31
  sta this.endFrame

  lda OBJECT.CALL.ARG.1,s
  sta.b dimension.position.x + 1

  lda OBJECT.CALL.ARG.2,s
  sta.b dimension.position.y + 1
/*
  jsr abstract.Iterator.reset

  lda.w #OBJID.Brake_icon
  jsr abstract.Iterator.each.byId
  bcc +
    CALL Brake_icon.getAllocatedPalette.MTD iterator.target
    sep #$20
    stx.b animation.palette.start
    sta.b animation.palette.id
    tya
    sta.b animation.palette.startid
    rep #$31
+
*/
  lda #SPRITE.turbo.PTR
  jsr abstract.Sprite.startAnimation
  sep #$20
  lda.b #$1
  sta.b animation.isLooping
  lda.b #$1
  sta.b animation.speed
  rts

  METHOD play
  jsr abstract.Sprite.playAnimation
  rep #$31
  lda.b this.endFrame
  jsr GLOBAL.checkFrameReached
  bcc +
    lda #300
    sta.b dimension.position.y + 1  
  	;CALL Turbo_icon.kill.MTD iterator.self

+ rts

  METHOD reset
  rep #$31
  sta this.endFrame

  lda OBJECT.CALL.ARG.1,s
  sta.b dimension.position.x + 1

  lda OBJECT.CALL.ARG.2,s
  sta.b dimension.position.y + 1
  rts

  METHOD getAllocatedPalette
  rep #$31  
  ldx.b animation.palette.start
  lda.b animation.palette.startid
  and.w #$ff
  tay
  lda.b animation.palette.id
  and.w #$ff
  rts
  
  METHOD kill
  rep #$31
  jsr abstract.Sprite.deallocate
  lda #OBJR_kill
  sta 3,s	
  rts

  CLASS Turbo_icon reset getAllocatedPalette
.ends	
	
